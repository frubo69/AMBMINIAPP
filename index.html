<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>AMBAR</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root{
  --gold:#C9A96E;--gold2:#E8C98A;--gold3:#F5E0B0;
  --bg:#07070E;--bg2:#0C0C18;--bg3:#111120;
  --card:#121224;--card2:#161628;
  --border:rgba(201,169,110,.16);--border2:rgba(255,255,255,.06);
  --text:#EDE9E0;--sub:#9896AA;--muted:#54526A;
  --red:#E05555;--green:#4CAF7D;
  --r:16px;--r2:12px;--r3:10px;
  --safe-bottom:env(safe-area-inset-bottom,0px);
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;-webkit-font-smoothing:antialiased}
html,body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;height:100%;overflow:hidden}
button,input{font-family:'Outfit',sans-serif;outline:none}
img{display:block}

/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.page{position:fixed;inset:0;bottom:calc(60px + var(--safe-bottom));overflow-y:auto;overflow-x:hidden;display:flex;flex-direction:column;opacity:1;transition:opacity .2s,transform .2s}
.page.hidden{opacity:0;pointer-events:none;transform:translateY(8px)}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.hdr{position:sticky;top:0;z-index:40;display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:rgba(7,7,14,.96);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border);flex-shrink:0}
.logo{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;letter-spacing:7px;background:linear-gradient(135deg,var(--gold),var(--gold2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.logo-sub{font-size:7px;letter-spacing:3px;text-transform:uppercase;color:var(--muted);margin-top:-2px}
.hdr-right{display:flex;gap:8px;align-items:center}
.cart-pill{display:flex;align-items:center;gap:6px;background:var(--card2);border:1px solid var(--border);border-radius:50px;padding:7px 13px;position:relative;cursor:pointer;transition:.15s}
.cart-pill:active{transform:scale(.93)}
.cart-txt{font-size:13px;font-weight:600;color:var(--gold2)}
.cart-dot{position:absolute;top:-5px;right:-5px;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#07070E;border-radius:50%;width:18px;height:18px;font-size:9px;font-weight:700;display:none;align-items:center;justify-content:center;border:2px solid var(--bg)}
.lang-btn{width:34px;height:34px;border-radius:50%;border:1px solid var(--border2);background:var(--card2);display:flex;align-items:center;justify-content:center;font-size:15px;cursor:pointer;transition:.15s}
.lang-btn:active{transform:scale(.85)}

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bnav{position:fixed;bottom:0;left:0;right:0;z-index:40;display:flex;background:rgba(7,7,14,.97);border-top:1px solid var(--border);padding-bottom:var(--safe-bottom)}
.nb{flex:1;display:flex;flex-direction:column;align-items:center;padding:9px 4px 7px;gap:3px;border:none;background:transparent;color:var(--muted);cursor:pointer;transition:.15s}
.nb.on{color:var(--gold)}
.nb i{font-size:20px;line-height:1}
.nb span{font-size:9px;letter-spacing:.5px;font-weight:500}

/* ‚îÄ‚îÄ CHIPS ‚îÄ‚îÄ */
.chips{display:flex;gap:7px;padding:12px 14px 6px;overflow-x:auto;scrollbar-width:none;flex-shrink:0}
.chips::-webkit-scrollbar{display:none}
.chip{white-space:nowrap;padding:7px 14px;border-radius:50px;border:1px solid var(--border2);background:transparent;color:var(--muted);font-size:11px;font-weight:500;cursor:pointer;transition:.15s}
.chip.on{background:rgba(201,169,110,.1);border-color:var(--gold);color:var(--gold);font-weight:700}

/* ‚îÄ‚îÄ SECTION HEADING ‚îÄ‚îÄ */
.sec-h{padding:14px 14px 10px;font-family:'Cormorant Garamond',serif;font-size:20px;display:flex;align-items:center;gap:10px;flex-shrink:0}
.sec-h::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,var(--border2),transparent)}

/* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:2px 12px 16px}
@media(min-width:460px){.grid{grid-template-columns:repeat(3,1fr)}}

.pcard{background:var(--card);border:1px solid var(--border2);border-radius:var(--r);overflow:hidden;display:flex;flex-direction:column;transition:.15s}
.pcard:active{transform:scale(.97)}
.pimg-box{height:148px;background:linear-gradient(155deg,#0E0E1E,#090916);display:flex;align-items:center;justify-content:center;padding:10px;position:relative;overflow:hidden}
.pimg{max-height:128px;max-width:90%;object-fit:contain;filter:drop-shadow(0 6px 20px rgba(0,0,0,.7))}
.pbadge{position:absolute;font-size:8px;letter-spacing:1px;text-transform:uppercase;padding:3px 7px;border-radius:6px;font-weight:700}
.pbadge.oos{left:8px;top:8px;background:rgba(0,0,0,.7);border:1px solid var(--border2);color:var(--muted)}
.pbadge.isnew{right:8px;top:8px;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#07070E}
.pinfo{padding:10px 11px 12px;flex:1;display:flex;flex-direction:column;gap:4px}
.pcat{font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--gold);font-weight:600}
.pname{font-family:'Cormorant Garamond',serif;font-size:15px;font-weight:600;line-height:1.2}
.pdesc{font-size:10px;color:var(--muted);line-height:1.45;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.pfoot{display:flex;align-items:center;justify-content:space-between;margin-top:auto;padding-top:8px}
.pprice{font-size:16px;font-weight:700;color:var(--gold2)}
.pprice small{font-size:9px;color:var(--muted);font-weight:400}
.add-btn{width:32px;height:32px;border-radius:9px;background:linear-gradient(135deg,var(--gold),var(--gold2));border:none;color:#07070E;font-size:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.13s}
.add-btn:active{transform:scale(.75)}
.add-btn:disabled{background:var(--card2);color:var(--muted);cursor:not-allowed}
.qctrl{display:flex;align-items:center;gap:5px}
.qb{width:28px;height:28px;border-radius:8px;border:1px solid var(--border);background:var(--bg3);color:var(--gold);font-size:18px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.12s}
.qb:active{transform:scale(.75)}
.qn{font-size:13px;font-weight:700;min-width:20px;text-align:center;color:var(--gold2)}

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.empty{text-align:center;padding:60px 20px;color:var(--muted)}
.empty-icon{font-size:54px;margin-bottom:14px;opacity:.3}

/* ‚îÄ‚îÄ CART ITEMS ‚îÄ‚îÄ */
.ci{display:flex;align-items:center;gap:11px;padding:13px 16px;border-bottom:1px solid var(--border2)}
.ci-img{width:50px;height:60px;object-fit:contain;background:var(--card);border-radius:10px;padding:5px;flex-shrink:0}
.ci-info{flex:1;min-width:0}
.ci-name{font-size:13px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ci-price{font-size:12px;color:var(--gold);font-weight:600;margin-top:2px}

/* ‚îÄ‚îÄ TIP ‚îÄ‚îÄ */
.tip-wrap{padding:14px 16px;border-top:1px solid var(--border2)}
.tip-label{font-size:9px;letter-spacing:2.5px;text-transform:uppercase;color:var(--muted);font-weight:600;margin-bottom:10px}
.tip-row{display:flex;flex-wrap:wrap;gap:7px}
.tip-chip{padding:8px 14px;border-radius:50px;border:1px solid var(--border2);background:transparent;color:var(--sub);font-size:12px;font-weight:500;cursor:pointer;transition:.15s}
.tip-chip.on{background:rgba(201,169,110,.1);border-color:var(--gold);color:var(--gold);font-weight:700}
.tip-input{width:100%;margin-top:10px;background:var(--bg3);border:1.5px solid var(--border2);border-radius:var(--r3);padding:11px 14px;color:var(--text);font-size:14px;display:none;transition:.2s}
.tip-input:focus{border-color:var(--gold)}

/* ‚îÄ‚îÄ CART FOOTER ‚îÄ‚îÄ */
.cart-foot{padding:14px 16px;background:var(--bg2);border-top:1px solid var(--border)}
.total-row{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:12px}
.total-lbl{font-size:9px;letter-spacing:2.5px;text-transform:uppercase;color:var(--muted);font-weight:600}
.total-val{font-family:'Cormorant Garamond',serif;font-size:28px;color:var(--gold2);font-weight:600}
.btn-main{width:100%;background:linear-gradient(135deg,var(--gold),var(--gold2),var(--gold3));color:#07070E;border:none;border-radius:14px;padding:15px;font-size:15px;font-weight:700;cursor:pointer;letter-spacing:.3px;transition:.15s}
.btn-main:active{transform:scale(.98);opacity:.9}
.btn-main:disabled{opacity:.3;cursor:not-allowed}
.btn-outline{width:100%;background:transparent;border:1.5px solid var(--border);color:var(--sub);border-radius:14px;padding:13px;font-size:14px;font-weight:500;cursor:pointer;margin-top:8px;transition:.15s}
.btn-outline:active{border-color:var(--gold);color:var(--gold)}

/* ‚îÄ‚îÄ CHECKOUT ‚îÄ‚îÄ */
.co-body{padding:14px 16px}
.co-card{background:var(--card);border:1px solid var(--border2);border-radius:var(--r);margin-bottom:12px;overflow:hidden}
.co-head{padding:13px 15px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--border2)}
.co-num{width:26px;height:26px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold2));color:#07070E;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.co-num.done{background:var(--green)}
.co-title{font-size:14px;font-weight:600}
.co-inner{padding:14px 15px}
.flabel{display:block;font-size:9px;letter-spacing:2.5px;text-transform:uppercase;color:var(--muted);margin-bottom:7px;font-weight:600}
.finput{width:100%;background:var(--bg3);border:1.5px solid var(--border2);border-radius:var(--r3);padding:12px 14px;color:var(--text);font-size:14px;transition:.2s}
.finput:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(201,169,110,.07)}
.finput::placeholder{color:var(--muted)}
.finput.err{border-color:var(--red)!important;box-shadow:0 0 0 3px rgba(224,85,85,.07)!important}
.ferr{font-size:11px;color:var(--red);margin-top:5px;display:none}
.ferr.on{display:block}

/* Location button */
.loc-btn{display:flex;align-items:center;gap:10px;width:100%;background:rgba(201,169,110,.07);border:1.5px solid rgba(201,169,110,.2);border-radius:var(--r2);padding:13px 15px;cursor:pointer;color:var(--gold);font-size:13px;font-weight:600;transition:.2s}
.loc-btn:active{transform:scale(.97)}
.loc-btn .li{font-size:22px}
.loc-state{margin-top:8px;font-size:12px;padding:9px 12px;border-radius:9px;display:none}
.loc-state.ok{display:block;background:rgba(76,175,125,.1);color:var(--green);border:1px solid rgba(76,175,125,.2)}
.loc-state.fail{display:block;background:rgba(224,85,85,.08);color:var(--red);border:1px solid rgba(224,85,85,.18)}
.office-badge{margin-top:7px;display:none;font-size:11px;color:var(--sub);background:var(--bg3);padding:8px 12px;border-radius:8px;line-height:1.5}
.office-badge.on{display:block}

/* Summary */
.sum-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:14px 16px;margin:0 16px 14px}
.sum-title{font-family:'Cormorant Garamond',serif;font-size:17px;color:var(--gold2);margin-bottom:10px}
.sum-line{display:flex;justify-content:space-between;font-size:12px;color:var(--sub);margin-bottom:5px}
.sum-div{height:1px;background:var(--border2);margin:8px 0}
.sum-total{display:flex;justify-content:space-between;font-size:15px;font-weight:700;color:var(--gold2)}
.co-foot{padding:0 16px 16px}

/* ‚îÄ‚îÄ ORDER CARDS ‚îÄ‚îÄ */
.ocard{background:var(--card);border:1px solid var(--border2);border-radius:var(--r);padding:14px;margin:0 14px 10px}
.ocard-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
.o-id{font-size:12px;font-weight:700;color:var(--gold2)}
.o-date{font-size:10px;color:var(--muted);margin-top:2px}
.o-status{font-size:10px;font-weight:600;padding:4px 10px;border-radius:50px}
.sp{background:rgba(201,169,110,.1);color:var(--gold);border:1px solid rgba(201,169,110,.2)}
.sc{background:rgba(76,175,125,.1);color:var(--green);border:1px solid rgba(76,175,125,.2)}
.sd{background:rgba(76,175,125,.15);color:var(--green);border:1px solid rgba(76,175,125,.25)}
.sx{background:rgba(224,85,85,.1);color:var(--red);border:1px solid rgba(224,85,85,.2)}
.o-items{font-size:12px;color:var(--sub);line-height:1.75;border-top:1px solid var(--border2);padding-top:8px;margin-top:4px}
.o-total{font-size:14px;font-weight:700;color:var(--gold2);margin-top:6px}

/* ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ */
.profile-card{background:var(--card);border:1px solid var(--border2);border-radius:var(--r);padding:20px;margin:14px}
.profile-avatar{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold2));display:flex;align-items:center;justify-content:center;font-size:28px;margin:0 auto 12px;font-family:'Cormorant Garamond',serif;color:#07070E;font-weight:700}
.profile-name{text-align:center;font-family:'Cormorant Garamond',serif;font-size:20px;color:var(--gold2)}
.profile-stat{display:flex;gap:0;border-top:1px solid var(--border2);margin-top:14px}
.ps{flex:1;text-align:center;padding:12px 6px;border-right:1px solid var(--border2)}
.ps:last-child{border-right:none}
.ps-n{font-size:20px;font-weight:700;color:var(--gold2)}
.ps-l{font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--muted);margin-top:2px}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{position:fixed;bottom:calc(68px + var(--safe-bottom));left:50%;transform:translateX(-50%) translateY(60px);background:var(--card2);border:1px solid var(--border);color:var(--text);padding:10px 20px;border-radius:50px;font-size:12px;white-space:nowrap;z-index:999;transition:transform .28s cubic-bezier(.34,1.06,.64,1);pointer-events:none;box-shadow:0 8px 28px rgba(0,0,0,.55)}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.ok{border-color:var(--green);color:#90e8b8}
.toast.err{border-color:var(--red);color:#f0a0a0}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CATALOG PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="pg-catalog" class="page">
  <div class="hdr">
    <div><div class="logo">AMBAR</div><div class="logo-sub">Premium Spirits</div></div>
    <div class="hdr-right">
      <div class="cart-pill" onclick="go('cart')">
        üõí <span class="cart-txt" id="hdr-tot">0 AED</span>
        <span class="cart-dot" id="hdr-dot">0</span>
      </div>
      <button class="lang-btn" onclick="flipLang()" id="lbtn">üá∑üá∫</button>
    </div>
  </div>
  <div class="chips" id="cat-chips"></div>
  <div class="sec-h" id="sh-catalog">–ö–∞—Ç–∞–ª–æ–≥</div>
  <div class="grid" id="p-grid"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CART PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="pg-cart" class="page hidden">
  <div class="hdr">
    <div><div class="logo">AMBAR</div><div class="logo-sub" id="ls-cart">–ö–æ—Ä–∑–∏–Ω–∞</div></div>
    <div class="hdr-right"><button class="lang-btn" onclick="flipLang()">üá∑üá∫</button></div>
  </div>
  <div id="cart-list"></div>
  <div id="tip-section" style="display:none">
    <div class="tip-wrap">
      <div class="tip-label" id="tip-lbl">–ß–ê–ï–í–´–ï</div>
      <div class="tip-row" id="tip-row"></div>
      <input class="tip-input" id="tip-input" type="number" min="0">
    </div>
  </div>
  <div id="cart-foot" style="display:none">
    <div class="cart-foot">
      <div class="total-row">
        <span class="total-lbl" id="tot-lbl">–ò–¢–û–ì–û</span>
        <span class="total-val"><span id="tot-n">0</span> AED</span>
      </div>
      <button class="btn-main" id="co-btn" onclick="go('checkout')">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ‚Üí</button>
      <button class="btn-outline" id="clear-btn" onclick="clearCart()">üóë –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CHECKOUT PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="pg-checkout" class="page hidden">
  <div class="hdr">
    <div><div class="logo">AMBAR</div><div class="logo-sub" id="ls-co">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</div></div>
    <div class="hdr-right"><button class="lang-btn" onclick="flipLang()">üá∑üá∫</button></div>
  </div>
  <div class="co-body">

    <!-- Step 1: Location -->
    <div class="co-card">
      <div class="co-head">
        <div class="co-num" id="n1">1</div>
        <div class="co-title" id="ct1">–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</div>
      </div>
      <div class="co-inner">
        <button class="loc-btn" onclick="grabLocation()" id="loc-btn">
          <span class="li">üìç</span>
          <span id="loc-btn-txt">–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</span>
        </button>
        <div class="loc-state" id="loc-state"></div>
        <div class="office-badge" id="office-badge"></div>
      </div>
    </div>

    <!-- Step 2: Address -->
    <div class="co-card">
      <div class="co-head">
        <div class="co-num" id="n2">2</div>
        <div class="co-title" id="ct2">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</div>
      </div>
      <div class="co-inner">
        <label class="flabel" id="addr-lbl">–£–õ–ò–¶–ê, –î–û–ú, –ö–í–ê–†–¢–ò–†–ê / –û–§–ò–°</label>
        <input class="finput" id="addr-in" type="text" placeholder="—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 5, –∫–≤. 12" oninput="clearErr('addr')">
        <div class="ferr" id="addr-err"></div>
      </div>
    </div>

    <!-- Step 3: Phone -->
    <div class="co-card">
      <div class="co-head">
        <div class="co-num" id="n3">3</div>
        <div class="co-title" id="ct3">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</div>
      </div>
      <div class="co-inner">
        <label class="flabel" id="phone-lbl">–¢–û–õ–¨–ö–û –¶–ò–§–†–´, 10‚Äì15 –ó–ù–ê–ö–û–í</label>
        <input class="finput" id="phone-in" type="tel" inputmode="numeric" placeholder="79001234567" oninput="clearErr('phone')">
        <div class="ferr" id="phone-err"></div>
      </div>
    </div>

  </div>

  <!-- Summary -->
  <div class="sum-card" id="sum-card">
    <div class="sum-title" id="sum-title">–í–∞—à –∑–∞–∫–∞–∑</div>
    <div id="sum-items"></div>
    <div class="sum-div"></div>
    <div class="sum-line" id="sum-tip-row" style="display:none">
      <span id="sum-tip-lbl">–ß–∞–µ–≤—ã–µ</span><span id="sum-tip-val">0 AED</span>
    </div>
    <div class="sum-total">
      <span id="sum-tot-lbl">–ò—Ç–æ–≥–æ</span>
      <span id="sum-tot-val">0 AED</span>
    </div>
  </div>

  <div class="co-foot">
    <button class="btn-main" id="place-btn" onclick="placeOrder()">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ORDERS PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="pg-orders" class="page hidden">
  <div class="hdr">
    <div><div class="logo">AMBAR</div><div class="logo-sub" id="ls-ord">–ò—Å—Ç–æ—Ä–∏—è</div></div>
    <div class="hdr-right"><button class="lang-btn" onclick="flipLang()">üá∑üá∫</button></div>
  </div>
  <div class="sec-h" id="sh-orders">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</div>
  <div id="orders-list"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILE PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="pg-profile" class="page hidden">
  <div class="hdr">
    <div><div class="logo">AMBAR</div><div class="logo-sub" id="ls-prof">–ü—Ä–æ—Ñ–∏–ª—å</div></div>
    <div class="hdr-right"><button class="lang-btn" onclick="flipLang()">üá∑üá∫</button></div>
  </div>
  <div class="profile-card">
    <div class="profile-avatar" id="prof-av">A</div>
    <div class="profile-name" id="prof-name">‚Äî</div>
    <div class="profile-stat">
      <div class="ps"><div class="ps-n" id="stat-total">0</div><div class="ps-l" id="stat-lbl1">–ó–ê–ö–ê–ó–û–í</div></div>
      <div class="ps"><div class="ps-n" id="stat-active">0</div><div class="ps-l" id="stat-lbl2">–ê–ö–¢–ò–í–ù–´–•</div></div>
      <div class="ps"><div class="ps-n" id="stat-spent">0</div><div class="ps-l" id="stat-lbl3">AED</div></div>
    </div>
  </div>
  <div style="padding:0 14px 14px">
    <div class="sec-h" id="sh-active">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</div>
    <div id="active-list"></div>
  </div>
</div>

<!-- BOTTOM NAV -->
<div class="bnav">
  <button class="nb on" id="nb-catalog" onclick="go('catalog')">
    <i>üçæ</i><span id="nbl-cat">–ö–∞—Ç–∞–ª–æ–≥</span>
  </button>
  <button class="nb" id="nb-cart" onclick="go('cart')">
    <i>üõí</i><span id="nbl-cart">–ö–æ—Ä–∑–∏–Ω–∞</span>
  </button>
  <button class="nb" id="nb-checkout" onclick="go('checkout');buildSummary()">
    <i>üìã</i><span id="nbl-co">–ó–∞–∫–∞–∑</span>
  </button>
  <button class="nb" id="nb-orders" onclick="go('orders')">
    <i>üì¶</i><span id="nbl-ord">–ò—Å—Ç–æ—Ä–∏—è</span>
  </button>
  <button class="nb" id="nb-profile" onclick="go('profile');buildProfile()">
    <i>üë§</i><span id="nbl-prof">–ü—Ä–æ—Ñ–∏–ª—å</span>
  </button>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// OFFICES + HAVERSINE ROUTING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const OFFICES=[
  {id:"office_central", name:"Ambar ‚Äî –¶–µ–Ω—Ç—Ä",   lat:55.7558, lon:37.6173},
  {id:"office_north",   name:"Ambar ‚Äî –°–µ–≤–µ—Ä",   lat:55.8200, lon:37.5900},
  {id:"office_south",   name:"Ambar ‚Äî –Æ–≥",      lat:55.6900, lon:37.6400},
];

function haversine(a,b,c,d){
  const R=6371,dl=(c-a)*Math.PI/180,dm=(d-b)*Math.PI/180;
  const e=Math.sin(dl/2)**2+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(dm/2)**2;
  return R*2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e));
}

function nearestOffice(lat,lon){
  return OFFICES.reduce((best,o)=>{
    const d=haversine(lat,lon,o.lat,o.lon);
    return(!best||d<best._d)?{...o,_d:d}:best;
  },null);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PRODUCTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const P=[
  {id:"p1",  cat:"–ö–æ–Ω—å—è–∫",      catE:"Cognac",    name:"Hennessy VS",          price:280, stock:true,  isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Hennessy_V.S_cognac.jpg/220px-Hennessy_V.S_cognac.jpg",
   dRu:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –∫–æ–Ω—å—è–∫, –Ω–æ—Ç—ã –≤–∞–Ω–∏–ª–∏ –∏ –¥—É–±–∞",
   dEn:"Classic French cognac with vanilla and oak notes"},
  {id:"p2",  cat:"–ö–æ–Ω—å—è–∫",      catE:"Cognac",    name:"Hennessy VSOP",        price:380, stock:true,  isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Hennessy_VSOP.jpg/220px-Hennessy_VSOP.jpg",
   dRu:"–í—ã–¥–µ—Ä–∂–∞–Ω–Ω—ã–π –∫–æ–Ω—å—è–∫ —Å –±–æ–≥–∞—Ç—ã–º —Ñ—Ä—É–∫—Ç–æ–≤—ã–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º",
   dEn:"Aged cognac with rich fruity character"},
  {id:"p3",  cat:"–ö–æ–Ω—å—è–∫",      catE:"Cognac",    name:"Hennessy XO",          price:880, stock:true,  isNew:true,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Hennessy_V.S_cognac.jpg/220px-Hennessy_V.S_cognac.jpg",
   dRu:"–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π XO ‚Äî —Ä–æ—Å–∫–æ—à—å –≤ –∫–∞–∂–¥–æ–π –∫–∞–ø–ª–µ",
   dEn:"Legendary XO ‚Äî luxury in every drop"},
  {id:"p4",  cat:"–í–∏—Å–∫–∏",       catE:"Whisky",    name:"Johnnie Walker Black", price:230, stock:true,  isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/JohnnieWalkerBlackLabel12Year.jpg/220px-JohnnieWalkerBlackLabel12Year.jpg",
   dRu:"–î—ã–º–Ω—ã–π —à–æ—Ç–ª–∞–Ω–¥—Å–∫–∏–π –≤–∏—Å–∫–∏ 12 –ª–µ—Ç –≤—ã–¥–µ—Ä–∂–∫–∏",
   dEn:"Smoky Scotch whisky aged 12 years"},
  {id:"p5",  cat:"–í–∏—Å–∫–∏",       catE:"Whisky",    name:"Johnnie Walker Blue",  price:720, stock:true,  isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Johnnie_Walker_Blue_Label.jpg/220px-Johnnie_Walker_Blue_Label.jpg",
   dRu:"–†–µ–¥–∫–∏–π –∫—É–ø–∞–∂ ‚Äî –≤–µ—Ä—à–∏–Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏",
   dEn:"Rare blend ‚Äî the pinnacle of the range"},
  {id:"p6",  cat:"–í–∏—Å–∫–∏",       catE:"Whisky",    name:"Jack Daniel's",        price:200, stock:true,  isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/Jack_Daniel%27s_bottle_2015.jpg/220px-Jack_Daniel%27s_bottle_2015.jpg",
   dRu:"–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π —Ç–µ–Ω–Ω–µ—Å—Å–∏–π—Å–∫–∏–π –≤–∏—Å–∫–∏",
   dEn:"Legendary Tennessee whiskey"},
  {id:"p7",  cat:"–í–æ–¥–∫–∞",       catE:"Vodka",     name:"Grey Goose",           price:260, stock:true,  isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Grey_Goose_vodka.jpg/220px-Grey_Goose_vodka.jpg",
   dRu:"–ü—Ä–µ–º–∏–∞–ª—å–Ω–∞—è –≤–æ–¥–∫–∞ –∏–∑ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–π –ø—à–µ–Ω–∏—Ü—ã",
   dEn:"Premium French wheat vodka"},
  {id:"p8",  cat:"–í–æ–¥–∫–∞",       catE:"Vodka",     name:"Belvedere",            price:290, stock:true,  isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a3/Belvedere_Vodka.jpg/220px-Belvedere_Vodka.jpg",
   dRu:"–ü–æ–ª—å—Å–∫–∞—è –≤–æ–¥–∫–∞ –≤—ã—Å—à–µ–≥–æ –∫–ª–∞—Å—Å–∞ –∏–∑ —Ä–∂–∏",
   dEn:"Ultra-premium Polish rye vodka"},
  {id:"p9",  cat:"–®–∞–º–ø–∞–Ω—Å–∫–æ–µ",  catE:"Champagne", name:"Mo√´t & Chandon Brut",  price:320, stock:true,  isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9d/Moet_et_Chandon.jpg/220px-Moet_et_Chandon.jpg",
   dRu:"–ò–∑—ã—Å–∫–∞–Ω–Ω–æ–µ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–µ —à–∞–º–ø–∞–Ω—Å–∫–æ–µ",
   dEn:"Iconic French champagne"},
  {id:"p10", cat:"–®–∞–º–ø–∞–Ω—Å–∫–æ–µ",  catE:"Champagne", name:"Dom P√©rignon",         price:1200,stock:true,  isNew:true,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Dom_Perignon.jpg/220px-Dom_Perignon.jpg",
   dRu:"–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –º–∏–ª–ª–µ–∑–∏–º–Ω—ã–π —à–∞–º–ø–∞–Ω—å",
   dEn:"The legendary vintage prestige cuv√©e"},
  {id:"p11", cat:"–¢–µ–∫–∏–ª–∞",      catE:"Tequila",   name:"Don Julio Blanco",     price:350, stock:true,  isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/25/Don_Julio_Blanco.jpg/220px-Don_Julio_Blanco.jpg",
   dRu:"100% –≥–æ–ª—É–±–∞—è –∞–≥–∞–≤–∞, –ú–µ–∫—Å–∏–∫–∞",
   dEn:"100% blue agave premium tequila"},
  {id:"p12", cat:"–†–æ–º",         catE:"Rum",       name:"Bacardi Blanca",       price:150, stock:true,  isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/Bacardi_Carta_Blanca.jpg/220px-Bacardi_Carta_Blanca.jpg",
   dRu:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –±–µ–ª—ã–π —Ä–æ–º, –ö—É–±–∞",
   dEn:"Classic Cuban white rum"},
  {id:"p13", cat:"–î–∂–∏–Ω",        catE:"Gin",       name:"Bombay Sapphire",      price:210, stock:true,  isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b0/BombaySapphire.jpg/220px-BombaySapphire.jpg",
   dRu:"–ê–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–∂–∏–Ω —Å 10 –±–æ—Ç–∞–Ω–∏—á–µ—Å–∫–∏–º–∏",
   dEn:"English gin with 10 botanicals"},
  {id:"p14", cat:"–õ–∏–∫—ë—Ä",       catE:"Liqueur",   name:"Malibu Coconut",       price:140, stock:false, isNew:false,
   img:"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e2/Malibu_Rum.jpg/220px-Malibu_Rum.jpg",
   dRu:"–ö–æ–∫–æ—Å–æ–≤—ã–π –ª–∏–∫—ë—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–º–∞",
   dEn:"Coconut flavoured rum liqueur"},
];

const TIP_OPTS=[0,50,100,200,500];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRANSLATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TX={
ru:{
  catalog:"–ö–∞—Ç–∞–ª–æ–≥",cart:"–ö–æ—Ä–∑–∏–Ω–∞",co:"–ó–∞–∫–∞–∑",orders:"–ò—Å—Ç–æ—Ä–∏—è",profile:"–ü—Ä–æ—Ñ–∏–ª—å",
  all:"–í—Å–µ",total:"–ò–¢–û–ì–û",tip:"–ß–ê–ï–í–´–ï",noTip:"–ë–µ–∑ —á–∞–µ–≤—ã—Ö",customTip:"‚úèÔ∏è –°–≤–æ—è",
  coBtn:"–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ‚Üí",clearCart:"üóë –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É",
  ct1:"–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è",ct2:"–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏",ct3:"–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
  locBtn:"üìç –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è",
  locGetting:"‚è≥ –û–ø—Ä–µ–¥–µ–ª—è–µ–º...",
  locOk:"‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ",
  locFail:"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ –±–µ–∑ –Ω–µ—ë.",
  officeLabel:"üè¢ –ë–ª–∏–∂–∞–π—à–∏–π –æ—Ñ–∏—Å:",
  addrLbl:"–£–õ–ò–¶–ê, –î–û–ú, –ö–í–ê–†–¢–ò–†–ê / –û–§–ò–°",
  addrPh:"—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 5, –∫–≤. 12",
  addrErr:"‚ùå –ê–¥—Ä–µ—Å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π ‚Äî –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤",
  phoneLbl:"–¢–û–õ–¨–ö–û –¶–ò–§–†–´, 10‚Äì15 –ó–ù–ê–ö–û–í",
  phonePh:"79001234567",
  phoneErr:"‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (10‚Äì15 —Ü–∏—Ñ—Ä, —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)",
  sumTitle:"–í–∞—à –∑–∞–∫–∞–∑",tipLbl:"–ß–∞–µ–≤—ã–µ",totLbl:"–ò—Ç–æ–≥–æ",
  placeBtn:"‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑",
  noOrders:"–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç",noActive:"–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤",
  stP:"üü° –û–∂–∏–¥–∞–µ—Ç",stC:"üü¢ –ü—Ä–∏–Ω—è—Ç",stD:"‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω",stX:"‚ùå –û—Ç–º–µ–Ω—ë–Ω",
  added:"–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É",emptyCart:"–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ ‚Äî –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞",
  placed:"‚úÖ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ –∑–≤–æ–Ω–∫–∞.",
  activeOrders:"–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã",oos:"–ù–ï–¢",
  statOrders:"–ó–ê–ö–ê–ó–û–í",statActive:"–ê–ö–¢–ò–í–ù–´–•",statSpent:"–ü–û–¢–†–ê–ß–ï–ù–û",
},
en:{
  catalog:"Catalog",cart:"Cart",co:"Order",orders:"History",profile:"Profile",
  all:"All",total:"TOTAL",tip:"TIP",noTip:"No tip",customTip:"‚úèÔ∏è Custom",
  coBtn:"Checkout ‚Üí",clearCart:"üóë Clear cart",
  ct1:"Geolocation",ct2:"Delivery address",ct3:"Phone number",
  locBtn:"üìç Tap to share location",
  locGetting:"‚è≥ Getting location...",
  locOk:"‚úÖ Location received",
  locFail:"‚ö†Ô∏è Could not get location. Continue without it.",
  officeLabel:"üè¢ Nearest office:",
  addrLbl:"STREET, BUILDING, APARTMENT",
  addrPh:"123 Example St, Apt 12",
  addrErr:"‚ùå Address too short ‚Äî minimum 10 characters",
  phoneLbl:"DIGITS ONLY, 10‚Äì15 DIGITS",
  phonePh:"79001234567",
  phoneErr:"‚ùå Enter a valid phone number (10‚Äì15 digits, numbers only)",
  sumTitle:"Your order",tipLbl:"Tip",totLbl:"Total",
  placeBtn:"‚úÖ Confirm order",
  noOrders:"No orders yet",noActive:"No active orders",
  stP:"üü° Pending",stC:"üü¢ Confirmed",stD:"‚úÖ Delivered",stX:"‚ùå Cancelled",
  added:"Added to cart",emptyCart:"Cart is empty ‚Äî add items from the catalog",
  placed:"‚úÖ Order placed! Our operator will call you.",
  activeOrders:"Active orders",oos:"N/A",
  statOrders:"ORDERS",statActive:"ACTIVE",statSpent:"SPENT AED",
},
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let lang="ru", cart={}, catF="all", tip=0, locInfo=null;
let orders=JSON.parse(localStorage.getItem("ambar_orders")||"[]");
const tg=window.Telegram?.WebApp||null;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener("DOMContentLoaded",()=>{
  if(tg){tg.ready();tg.expand();tg.setHeaderColor&&tg.setHeaderColor("#07070E");tg.setBackgroundColor&&tg.setBackgroundColor("#07070E");}
  buildChips();renderGrid();buildTips();renderOrders();applyLang();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LANG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function t(k){return TX[lang][k]||TX.ru[k]||k;}
function flipLang(){
  lang=lang==="ru"?"en":"ru";
  document.querySelectorAll(".lang-btn").forEach(b=>b.textContent=lang==="ru"?"üá∑üá∫":"üá¨üáß");
  applyLang();buildChips();renderGrid();buildTips();renderOrders();renderCart();buildSummary();buildProfile();
}
function applyLang(){
  const f=lang==="ru"?"üá∑üá∫":"üá¨üáß";
  document.querySelectorAll(".lang-btn").forEach(b=>b.textContent=f);
  set("sh-catalog",t("catalog")); set("ls-cart",t("cart")); set("ls-co",t("co"));
  set("ls-ord",t("orders")); set("ls-prof",t("profile"));
  set("sh-orders",t("orders")); set("sh-active",t("activeOrders"));
  set("nbl-cat",t("catalog")); set("nbl-cart",t("cart")); set("nbl-co",t("co"));
  set("nbl-ord",t("orders")); set("nbl-prof",t("profile"));
  set("tot-lbl",t("total")); set("co-btn",t("coBtn")); set("clear-btn",t("clearCart"));
  set("ct1",t("ct1")); set("ct2",t("ct2")); set("ct3",t("ct3"));
  set("loc-btn-txt",t("locBtn"));
  set("addr-lbl",t("addrLbl")); el("addr-in").placeholder=t("addrPh");
  set("phone-lbl",t("phoneLbl")); el("phone-in").placeholder=t("phonePh");
  set("sum-title",t("sumTitle")); set("sum-tip-lbl",t("tipLbl")); set("sum-tot-lbl",t("totLbl"));
  set("place-btn",t("placeBtn")); set("tip-lbl",t("tip"));
  el("tip-input").placeholder=lang==="ru"?"–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É...":"Enter amount...";
}
function el(id){return document.getElementById(id);}
function set(id,v){const e=el(id);if(e)e.textContent=v;}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let curPg="catalog";
const PAGES=["catalog","cart","checkout","orders","profile"];
function go(p){
  PAGES.forEach(id=>{
    el("pg-"+id)?.classList.toggle("hidden",id!==p);
    el("nb-"+id)?.classList.toggle("on",id===p);
  });
  curPg=p;
  if(p==="cart")renderCart();
  if(p==="orders")renderOrders();
  if(p==="checkout")buildSummary();
  if(p==="profile")buildProfile();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CATEGORY CHIPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildChips(){
  const cats=["all",...new Set(P.map(p=>lang==="ru"?p.cat:p.catE))];
  el("cat-chips").innerHTML=cats.map(c=>{
    const lbl=c==="all"?t("all"):c;
    return`<button class="chip${c===catF?" on":""}" onclick="setCat('${c}',this)">${lbl}</button>`;
  }).join("");
}
function setCat(c,btn){
  catF=c;
  document.querySelectorAll(".chip").forEach(b=>b.classList.remove("on"));
  btn.classList.add("on");
  renderGrid();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GRID
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderGrid(){
  const list=catF==="all"?P:P.filter(p=>(lang==="ru"?p.cat:p.catE)===catF);
  el("p-grid").innerHTML=list.map(p=>{
    const qty=cart[p.id]||0;
    return`<div class="pcard">
      <div class="pimg-box">
        ${!p.stock?`<span class="pbadge oos">${t("oos")}</span>`:""}
        ${p.isNew?`<span class="pbadge isnew">NEW</span>`:""}
        <img class="pimg" src="${p.img}" alt="${p.name}"
          onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 80 80%22><text y=%2268%22 font-size=%2264%22>üçæ</text></svg>'">
      </div>
      <div class="pinfo">
        <div class="pcat">${lang==="ru"?p.cat:p.catE}</div>
        <div class="pname">${p.name}</div>
        <div class="pdesc">${lang==="ru"?p.dRu:p.dEn}</div>
        <div class="pfoot">
          <div class="pprice">${p.price}<small> AED</small></div>
          <div id="ctrl-${p.id}">${ctrlHTML(p,qty)}</div>
        </div>
      </div>
    </div>`;
  }).join("");
}

function ctrlHTML(p,qty){
  if(qty===0) return`<button class="add-btn"${!p.stock?" disabled":""} onclick="addItem('${p.id}')">+</button>`;
  return`<div class="qctrl">
    <button class="qb" onclick="chgQty('${p.id}',-1)">‚àí</button>
    <span class="qn">${qty}</span>
    <button class="qb" onclick="chgQty('${p.id}',1)">+</button>
  </div>`;
}

function addItem(id){
  const p=P.find(x=>x.id===id); if(!p||!p.stock) return;
  cart[id]=1; syncCtrl(id); updHdr();
  showToast(t("added")+": "+p.name,"ok");
}

function chgQty(id,d){
  const nq=(cart[id]||0)+d;
  if(nq<=0) delete cart[id]; else cart[id]=nq;
  syncCtrl(id); updHdr();
  if(curPg==="cart") renderCart();
}

function syncCtrl(id){
  const e=el("ctrl-"+id); if(!e) return;
  const p=P.find(x=>x.id===id);
  e.innerHTML=ctrlHTML(p,cart[id]||0);
}

function cartSubtotal(){
  return Object.entries(cart).reduce((s,[id,qty])=>{
    const p=P.find(x=>x.id===id); return s+(p?p.price*qty:0);
  },0);
}

function updHdr(){
  const cnt=Object.values(cart).reduce((a,b)=>a+b,0);
  const tot=cartSubtotal();
  el("hdr-tot").textContent=tot>0?tot+" AED":"0 AED";
  const dot=el("hdr-dot"); dot.textContent=cnt; dot.style.display=cnt>0?"flex":"none";
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CART
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderCart(){
  const entries=Object.entries(cart).filter(([,q])=>q>0);
  const foot=el("cart-foot"), tipSec=el("tip-section");
  if(!entries.length){
    el("cart-list").innerHTML=`<div class="empty"><div class="empty-icon">üõí</div><div>${t("emptyCart")}</div></div>`;
    foot.style.display="none"; tipSec.style.display="none"; return;
  }
  el("cart-list").innerHTML=entries.map(([id,qty])=>{
    const p=P.find(x=>x.id===id); if(!p) return"";
    return`<div class="ci">
      <img class="ci-img" src="${p.img}" alt="${p.name}"
        onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 52 62%22><text y=%2248%22 font-size=%2240%22>üçæ</text></svg>'">
      <div class="ci-info"><div class="ci-name">${p.name}</div><div class="ci-price">${p.price*qty} AED</div></div>
      <div class="qctrl">
        <button class="qb" onclick="chgQty('${id}',-1)">‚àí</button>
        <span class="qn">${qty}</span>
        <button class="qb" onclick="chgQty('${id}',1)">+</button>
      </div>
    </div>`;
  }).join("");
  el("tot-n").textContent=cartSubtotal()+tip;
  foot.style.display="block"; tipSec.style.display="block";
}

function clearCart(){
  cart={}; tip=0; updHdr(); renderCart(); buildTips();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TIPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildTips(){
  el("tip-row").innerHTML=TIP_OPTS.map((v,i)=>{
    const isLast=i===TIP_OPTS.length-1;
    const lbl=isLast?t("customTip"):(v===0?t("noTip"):`${v} AED`);
    return`<button class="tip-chip${v===tip&&!isLast?" on":""}" onclick="pickTip(${v},${isLast},this)">${lbl}</button>`;
  }).join("");
  el("tip-input").placeholder=lang==="ru"?"–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É...":"Enter amount...";
}

function pickTip(v,isCustom,btn){
  document.querySelectorAll(".tip-chip").forEach(b=>b.classList.remove("on"));
  btn.classList.add("on");
  const inp=el("tip-input");
  if(isCustom){
    inp.style.display="block"; inp.focus();
    inp.oninput=()=>{tip=Math.max(0,parseInt(inp.value)||0); updCartTot();};
  } else {
    inp.style.display="none"; tip=v; updCartTot();
  }
}

function updCartTot(){
  el("tot-n").textContent=cartSubtotal()+tip;
  buildSummary();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOCATION (GPS)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function grabLocation(){
  const btn=el("loc-btn"), stat=el("loc-state"), ob=el("office-badge");
  btn.style.opacity="0.6";
  el("loc-btn-txt").textContent=t("locGetting");
  stat.className="loc-state"; ob.className="office-badge";

  if(!navigator.geolocation){
    locInfo=null; btn.style.opacity="1"; el("loc-btn-txt").textContent=t("locBtn");
    stat.className="loc-state fail"; stat.textContent=t("locFail"); return;
  }

  navigator.geolocation.getCurrentPosition(
    pos=>{
      const {latitude:lat,longitude:lon}=pos.coords;
      const off=nearestOffice(lat,lon);
      locInfo={lat,lon,office_id:off.id,office_name:off.name,dist_km:off._d.toFixed(1)};
      btn.style.opacity="1"; el("loc-btn-txt").textContent=t("locBtn");
      stat.className="loc-state ok"; stat.textContent=t("locOk");
      ob.className="office-badge on";
      ob.innerHTML=`${t("officeLabel")} <strong>${off.name}</strong> ¬∑ ${off._d.toFixed(1)} km`;
      el("n1").className="co-num done"; el("n1").textContent="‚úì";
    },
    ()=>{
      locInfo=null; btn.style.opacity="1"; el("loc-btn-txt").textContent=t("locBtn");
      stat.className="loc-state fail"; stat.textContent=t("locFail");
    },
    {timeout:10000,maximumAge:60000,enableHighAccuracy:true}
  );
}

function clearErr(field){
  el(field+"-in").classList.remove("err");
  el(field+"-err").classList.remove("on");
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUMMARY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildSummary(){
  const entries=Object.entries(cart).filter(([,q])=>q>0);
  const sub=cartSubtotal();
  el("sum-items").innerHTML=entries.map(([id,qty])=>{
    const p=P.find(x=>x.id===id);
    return p?`<div class="sum-line"><span>${p.name} √ó${qty}</span><span>${p.price*qty} AED</span></div>`:"";
  }).join("");
  const tr=el("sum-tip-row");
  if(tip>0){tr.style.display="flex"; el("sum-tip-val").textContent=tip+" AED";}
  else tr.style.display="none";
  el("sum-tot-val").textContent=(sub+tip)+" AED";
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PLACE ORDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function placeOrder(){
  const entries=Object.entries(cart).filter(([,q])=>q>0);
  if(!entries.length){showToast(t("emptyCart"),"err");return;}

  // Validate address
  const addr=el("addr-in").value.trim();
  if(addr.length<10){
    el("addr-in").classList.add("err");
    el("addr-err").textContent=t("addrErr");
    el("addr-err").classList.add("on");
    el("addr-in").focus(); go("checkout"); return;
  }

  // Validate phone ‚Äî digits only, 10-15 chars
  const rawPhone=el("phone-in").value.trim();
  const digits=rawPhone.replace(/\D/g,"");
  if(digits.length<10||digits.length>15||!/^\+?\d+$/.test(rawPhone)){
    el("phone-in").classList.add("err");
    el("phone-err").textContent=t("phoneErr");
    el("phone-err").classList.add("on");
    el("phone-in").focus(); go("checkout"); return;
  }

  const items=entries.map(([id,qty])=>{
    const p=P.find(x=>x.id===id);
    return{id,name:p.name,price:p.price,qty,line_total:p.price*qty};
  });
  const sub=cartSubtotal(), total=sub+tip;
  const oid="AMB"+Date.now().toString().slice(-7);

  const payload={
    action:"order", order_id:oid,
    items, subtotal:sub, tip, total, currency:"AED",
    phone:digits, address:addr,
    location: locInfo ? {lat:locInfo.lat,lon:locInfo.lon} : {lat:0,lon:0},
    office_id: locInfo?.office_id || "office_central",
    office_name: locInfo?.office_name || "Ambar",
    lang,
  };

  // Store locally
  orders.unshift({order_id:oid,items,total,address:addr,status:"pending",timestamp:new Date().toISOString()});
  localStorage.setItem("ambar_orders",JSON.stringify(orders.slice(0,50)));

  if(tg?.sendData){
    tg.sendData(JSON.stringify(payload));
  } else {
    console.log("ORDER PAYLOAD:",JSON.stringify(payload,null,2));
  }

  // Reset
  cart={}; tip=0; locInfo=null;
  el("addr-in").value=""; el("phone-in").value="";
  el("loc-state").className="loc-state"; el("office-badge").className="office-badge";
  el("n1").className="co-num"; el("n1").textContent="1";
  updHdr(); buildTips();
  showToast(t("placed"),"ok");
  setTimeout(()=>go("orders"),1400);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ORDERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderOrders(){
  if(!orders.length){
    el("orders-list").innerHTML=`<div class="empty"><div class="empty-icon">üì¶</div><div>${t("noOrders")}</div></div>`;
    return;
  }
  const cls={pending:"sp",confirmed:"sc",delivered:"sd",declined:"sx"};
  const lbl={pending:()=>t("stP"),confirmed:()=>t("stC"),delivered:()=>t("stD"),declined:()=>t("stX")};
  el("orders-list").innerHTML=orders.map(o=>{
    const ts=o.timestamp?o.timestamp.slice(0,16).replace("T"," "):"";
    const sc=cls[o.status]||"sp", sl=(lbl[o.status]||lbl.pending)();
    return`<div class="ocard">
      <div class="ocard-top">
        <div><div class="o-id">#${o.order_id}</div><div class="o-date">${ts}</div></div>
        <span class="o-status ${sc}">${sl}</span>
      </div>
      <div class="o-items">${o.items.map(i=>`${i.name} √ó${i.qty}`).join(" ¬∑ ")}</div>
      <div class="o-total">${o.total} AED</div>
    </div>`;
  }).join("");
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROFILE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildProfile(){
  const name=tg?.initDataUnsafe?.user?.first_name||"Guest";
  const av=name[0]?.toUpperCase()||"A";
  el("prof-av").textContent=av; el("prof-name").textContent=name;

  const active=orders.filter(o=>["pending","confirmed"].includes(o.status));
  const spent=orders.filter(o=>o.status==="delivered").reduce((s,o)=>s+o.total,0);
  el("stat-total").textContent=orders.length;
  el("stat-active").textContent=active.length;
  el("stat-spent").textContent=spent;
  el("stat-lbl1").textContent=t("statOrders");
  el("stat-lbl2").textContent=t("statActive");
  el("stat-lbl3").textContent=t("statSpent");

  if(!active.length){
    el("active-list").innerHTML=`<div class="empty" style="padding:20px 0"><div>${t("noActive")}</div></div>`;
    return;
  }
  const cls={pending:"sp",confirmed:"sc"};
  const lbl={pending:()=>t("stP"),confirmed:()=>t("stC")};
  el("active-list").innerHTML=active.map(o=>{
    const sc=cls[o.status]||"sp", sl=(lbl[o.status]||lbl.pending)();
    return`<div class="ocard">
      <div class="ocard-top">
        <div><div class="o-id">#${o.order_id}</div></div>
        <span class="o-status ${sc}">${sl}</span>
      </div>
      <div class="o-items">${o.items.map(i=>`${i.name} √ó${i.qty}`).join(" ¬∑ ")}</div>
      <div class="o-total">${o.total} AED</div>
    </div>`;
  }).join("");
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let toastTimer;
function showToast(msg,type=""){
  const e=el("toast");
  e.textContent=msg; e.className="toast "+(type||""); e.classList.add("show");
  clearTimeout(toastTimer); toastTimer=setTimeout(()=>e.classList.remove("show"),2800);
}
</script>
</body>
</html>
